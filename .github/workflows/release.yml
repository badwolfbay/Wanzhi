name: Build and Release

on:
  push:
    tags:
      - 'v*.*.*'  # è§¦å‘æ¡ä»¶: æ¨é€ç‰ˆæœ¬æ ‡ç­¾ (ä¾‹å¦‚ v1.0.0)

jobs:
  build-and-release:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Setup .NET
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'
        
    - name: Restore dependencies
      run: dotnet restore Wanzhi/Wanzhi.csproj
      
    - name: Build Release
      run: dotnet publish Wanzhi/Wanzhi.csproj -c Release -r win-x64 --self-contained false -p:PublishSingleFile=true -o publish
      
    - name: Create portable package
      run: |
        $version = "${{ github.ref_name }}"
        Compress-Archive -Path publish\* -DestinationPath "Wanzhi_${version}_Portable.zip"
      shell: pwsh
      
    - name: Get version from tag
      id: get_version
      run: |
        $version = "${{ github.ref_name }}" -replace '^v', ''
        echo "VERSION=$version" >> $env:GITHUB_OUTPUT
      shell: pwsh
      
    - name: Create Release
      uses: softprops/action-gh-release@v1
      with:
        name: ä¸‡æ ${{ github.ref_name }} - Release
        body: |
          # ä¸‡æ ${{ github.ref_name }}
          
          ## ğŸ“¦ ä¸‹è½½
          
          ### ä¾¿æºç‰ˆ (æ¨è)
          - è§£å‹å³ç”¨ï¼Œæ— éœ€å®‰è£…
          - éœ€è¦ [.NET 8.0 Desktop Runtime](https://dotnet.microsoft.com/download/dotnet/8.0)
          
          ## âœ¨ ä¸»è¦ç‰¹æ€§
          
          - ğŸ¨ ç²¾ç¾çš„æ³¢æµªåŠ¨ç”»èƒŒæ™¯
          - ğŸ“œ æ¯æ—¥è¯—è¯è‡ªåŠ¨æ›´æ–°
          - ğŸ­ æ”¯æŒç«–æ’/æ¨ªæ’åŒå‘æ’ç‰ˆ
          - ğŸŒˆ è‡ªå®šä¹‰èƒŒæ™¯è‰²å’Œæ³¢æµªè‰²
          - ğŸ–‹ï¸ å­—ä½“å’Œå­—å·è‡ªç”±è°ƒæ•´
          
          ## ğŸš€ å¿«é€Ÿå¼€å§‹
          
          1. ä¸‹è½½å¹¶è§£å‹
          2. è¿è¡Œ `Wanzhi.exe`
          3. å³é”®æ‰˜ç›˜å›¾æ ‡ â†’ è®¾ç½®
          4. ç‚¹å‡»"åº”ç”¨å£çº¸"
          
          ---
          
          å®Œæ•´æ–‡æ¡£: [README.md](https://github.com/${{ github.repository }}/blob/main/README.md)
        files: |
          Wanzhi_${{ github.ref_name }}_Portable.zip
        draft: false
        prerelease: false
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
